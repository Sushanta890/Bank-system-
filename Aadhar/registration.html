<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>S.K SIM ‚Üí Aadhaar Registration</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    font-family: Segoe UI;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}
.box{
    width: 360px;
    background: #111;
    padding: 20px;
    border-radius: 15px;
    animation: fade .6s;
}
@keyframes fade{
    from{opacity:0;transform:translateY(40px)}
    to{opacity:1}
}
input, select, button{
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border: none;
    border-radius: 8px;
}
input, select{background: #222; color: #fff}
button{
    background: #00e6ff;
    font-weight: bold;
    cursor: pointer;
}
.step{display:none}
.step.active{display:block}
.card{
    background:#1b1b1b;
    padding:15px;
    border-radius:12px;
    margin-top:10px;
}
.qr{
    background:#fff;
    color:#000;
    padding:10px;
    border-radius:8px;
    text-align:center;
}
img.preview{
    width: 100px;
    height: 100px;
    border-radius: 8px;
    margin-top: 8px;
    object-fit: cover;
}
</style>
</head>
<body>

<div class="box">
<h2>S.K SIM ‚Üí Aadhaar</h2>

<!-- STEP 1: Enter SIM Number -->
<div class="step active" id="step1">
    <input id="sim" placeholder="Enter S.K SIM Number">
    <button onclick="sendOTP()">Proceed</button>
</div>

<!-- STEP 2: Enter OTP -->
<div class="step" id="step2">
    <input id="otp" placeholder="Enter OTP received in chat">
    <button onclick="verifyOTP()">Verify OTP</button>
</div>

<!-- STEP 3: Enter Personal Info -->
<div class="step" id="step3">
    <input id="fname" placeholder="First Name">
    <input id="lname" placeholder="Last Name">
    <input id="dob" type="date">
    <select id="gender">
        <option value="">Gender</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
    </select>
    <input type="file" id="photo" accept="image/*" onchange="previewImage(event)">
    <img id="preview" class="preview" src="" alt="Preview" style="display:none;">
    <select id="state">
        <option value="">Select State</option>
        <option>Maharashtra</option>
        <option>Kerala</option>
        <option>Karnataka</option>
        <option>Tamil Nadu</option>
    </select>
    <select id="district">
        <option value="">Select District</option>
        <option>Mumbai</option>
        <option>Pune</option>
        <option>Bangalore</option>
        <option>Chennai</option>
    </select>
    <select id="city">
        <option value="">Select City</option>
        <option>City 1</option>
        <option>City 2</option>
        <option>City 3</option>
    </select>
    <input id="village" placeholder="Village/Locality">
    <button onclick="generateAadhaar()">Generate Aadhaar</button>
</div>

<!-- STEP 4: Show Result -->
<div class="step" id="step4">
    <div id="result"></div>
</div>

</div>

<script>
// ===== GLOBALS =====
let generatedOTP = "";
let verifiedSIM = "";
let photoData = "";

// Show a step
function showStep(n){
    document.querySelectorAll(".step").forEach(s=>s.classList.remove("active"));
    document.getElementById("step"+n).classList.add("active");
}

// Generate random 12-digit Aadhaar
function genAadhaar(){
    let n="";
    for(let i=0;i<12;i++) n+=Math.floor(Math.random()*10);
    return n;
}

// STEP 1: Send OTP
function sendOTP(){
    const sim = document.getElementById("sim").value.trim();
    if(sim.length !== 10){
        alert("Enter valid 10-digit S.K SIM number");
        return;
    }
    const simDB = JSON.parse(localStorage.getItem("skSIM")) || [];
    if(!simDB.find(s=>s.simNumber===sim)){
        alert("‚ùå SIM number not registered");
        return;
    }
    generatedOTP = Math.floor(100000 + Math.random()*900000).toString();
    verifiedSIM = sim;
    receiveAadhaarOTP(generatedOTP);
    alert("üì© OTP sent to your chat. Please open S.K SIM Chat to view it.");
    showStep(2);
}

// STEP 2: Verify OTP
function verifyOTP(){
    const otp = document.getElementById("otp").value.trim();
    if(otp !== generatedOTP){
        alert("‚ùå Invalid OTP");
        return;
    }
    showStep(3);
}

// STEP 3: Preview Image
function previewImage(event){
    const reader = new FileReader();
    reader.onload = function(){
        const output = document.getElementById('preview');
        output.src = reader.result;
        output.style.display = 'block';
        photoData = reader.result;
    };
    reader.readAsDataURL(event.target.files[0]);
}

// STEP 3: Generate Aadhaar
function generateAadhaar(){
    const fname = document.getElementById("fname").value.trim();
    const lname = document.getElementById("lname").value.trim();
    const dob = document.getElementById("dob").value;
    const gender = document.getElementById("gender").value;
    const state = document.getElementById("state").value;
    const district = document.getElementById("district").value;
    const city = document.getElementById("city").value;
    const village = document.getElementById("village").value;

    if(!fname || !lname || !dob || !gender || !state || !district || !city || !village){
        alert("Please fill all fields");
        return;
    }

    const aadhaarNumber = genAadhaar();
    const id4 = Math.floor(1000 + Math.random()*9000);

    const data = {sim: verifiedSIM, fname, lname, dob, gender, state, district, city, village, aadhaar: aadhaarNumber, id: id4, photo: photoData};

    const db = JSON.parse(localStorage.getItem("aadhaarDB")) || [];
    db.push(data);
    localStorage.setItem("aadhaarDB", JSON.stringify(db));

    document.getElementById("result").innerHTML = `
        <div class="card">
            <b>${fname} ${lname}</b><br>
            <small>SIM: ${verifiedSIM}</small><br>
            <div><b>Aadhaar:</b> ${aadhaarNumber}</div>
            <div><b>ID:</b> ${id4}</div>
            <div><b>State:</b> ${state}</div>
            <div><b>District:</b> ${district}</div>
            <div><b>City:</b> ${city}</div>
            <div><b>Village:</b> ${village}</div>
            <img src="${photoData}" class="preview"><br>
            <div class="qr">${aadhaarNumber}</div>
            <small>‚úÖ Aadhaar linked with S.K SIM successfully</small>
        </div>
    `;
    showStep(4);
}

// ===== CHAT SYSTEM FUNCTION =====
function receiveAadhaarOTP(otp){
    const time = new Date().toLocaleTimeString();
    const otpMsg = {id: crypto.randomUUID(), from:"S.K-SYSTEM", text:`üîê Your Aadhaar OTP is ${otp}`, time};
    const inboxKey = "inbox_" + verifiedSIM;
    const inbox = JSON.parse(localStorage.getItem(inboxKey)) || [];
    inbox.push(otpMsg);
    localStorage.setItem(inboxKey, JSON.stringify(inbox));
    if(typeof unreadCount === "function") unreadCount();
}
</script>

</body>
</html>
